{% extends 'base.html' %}

{% block title %}Profile - Eloutfit{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0"><i class="fas fa-user me-2"></i>My Profile</h2>
                <a href="{% url 'order_history' %}" class="btn btn-outline-primary">
                    <i class="fas fa-history me-2"></i>Order History
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0"><i class="fas fa-edit me-2"></i>Edit Profile Information</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ user_form.first_name.id_for_label }}" class="form-label fw-bold">First
                                    Name</label>
                                {{ user_form.first_name }}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="{{ user_form.last_name.id_for_label }}" class="form-label fw-bold">Last
                                    Name</label>
                                {{ user_form.last_name }}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="{{ user_form.email.id_for_label }}" class="form-label fw-bold">Email
                                Address</label>
                            {{ user_form.email }}
                        </div>

                        <hr class="my-4">

                        <h6 class="mb-3"><i class="fas fa-truck me-2"></i>Shipping Information</h6>

                        <div class="mb-3">
                            <label for="{{ profile_form.phone.id_for_label }}" class="form-label fw-bold">Phone
                                Number</label>
                            {{ profile_form.phone }}
                        </div>

                        <div class="mb-3">
                            <label for="{{ profile_form.address.id_for_label }}"
                                class="form-label fw-bold">Address</label>
                            {{ profile_form.address }}
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="{{ profile_form.city.id_for_label }}"
                                    class="form-label fw-bold">City</label>
                                {{ profile_form.city }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="{{ profile_form.state.id_for_label }}"
                                    class="form-label fw-bold">State</label>
                                {{ profile_form.state }}
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="{{ profile_form.zip_code.id_for_label }}" class="form-label fw-bold">ZIP
                                    Code</label>
                                {{ profile_form.zip_code }}
                            </div>
                        </div>
                        <!-- Change Password Section -->


                    </form>
                </div>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Update Profile
                </button>
            </div>
            </form>
        

            <div class="card mb-4 mt-3">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-shield-lock me-2"></i>Change Password
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" action="{% url 'change_password' %}" id="changePasswordForm">
                        {% csrf_token %}

                        {% if messages %}
                        <div class="mb-3">
                            {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="old_password" class="form-label">Current Password</label>
                                <input type="password" class="form-control" id="old_password" name="old_password"
                                    required>
                                <div class="form-text">Enter your current password</div>
                            </div>

                            <div class="col-12">
                                <label for="new_password1" class="form-label">New Password</label>
                                <input type="password" class="form-control" id="new_password1" name="new_password1"
                                    required>
                                <div class="form-text password-requirements">
                                    Password must contain at least 8 characters including uppercase,
                                    lowercase, and numbers.
                                </div>
                            </div>

                            <div class="col-12">
                                <label for="new_password2" class="form-label">Confirm New Password</label>
                                <input type="password" class="form-control" id="new_password2" name="new_password2"
                                    required>
                                <div class="form-text">Re-enter your new password</div>
                            </div>

                            <div class="col-12">
                                <button type="submit" class="btn btn-dark">
                                    <i class="bi bi-key me-2"></i>Update Password
                                </button>
                                <a href="{% url 'password_reset' %}" class="btn btn-outline-dark ms-2">
                                    <i class="bi bi-question-circle me-2"></i>Forgot Password?
                                </a>
                            </div>
                        </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0"><i class="fas fa-clock me-2"></i>Recent Activity</h5>
                </div>
                <div class="card-body">
                    {% if recent_orders %}
                    <h6 class="text-primary mb-3">Recent Orders</h6>
                    {% for order in recent_orders %}
                    <div class="border-start border-primary ps-3 mb-3">
                        <strong>Order #{{ order.order_number }}</strong>
                        <div class="small text-muted">
                            {{ order.created_at|date:"M d, Y" }} â€¢ ${{ order.total_amount }}
                        </div>
                        <span
                            class="badge bg-{% if order.status == 'completed' %}success{% elif order.status == 'cancelled' %}danger{% else %}warning{% endif %}">
                            {{ order.status|title }}
                        </span>
                    </div>
                    {% endfor %}
                    <a href="{% url 'order_history' %}" class="btn btn-outline-primary btn-sm w-100">
                        View All Orders
                    </a>
                    {% else %}
                    <div class="text-center py-3">
                        <i class="fas fa-shopping-bag fa-2x text-muted mb-3"></i>
                        <p class="text-muted mb-0">No orders yet</p>
                        <a href="{% url 'product_list' %}" class="btn btn-primary btn-sm mt-2">Start Shopping</a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="card shadow-sm mt-4">
                <div class="card-body text-center">
                    <h6>Account Actions</h6>
                    <div class="d-grid gap-2">
                        <a href="{% url 'logout' %}" class="btn btn-outline-danger">
                            <i class="fas fa-sign-out-alt me-2"></i>Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}