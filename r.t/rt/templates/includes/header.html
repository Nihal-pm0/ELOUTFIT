{% load static %}
<header id="header" class="site-header position-fixed top-0 start-0 w-100 bg-white z-3">
  <nav id="header-nav" class="navbar navbar-expand-lg px-2 px-md-3 py-1 py-md-2">
    <div class="container-fluid">
      <!-- Logo - Smaller on mobile -->
      <a class="navbar-brand p-0" href="{% url 'home' %}">
        <img src="{% static 'images/eloutfit.png' %}" class="logo" style="width: 70px; height: 50px;">
      </a>

      <!-- Search Bar - Hidden on mobile, visible on desktop -->
      <div class="d-none d-lg-block">
        <form action="{% url 'search' %}" method="get" class="search-form">
          <div class="input-group" style="max-width: 200px;">
            <input type="text" name="q" class="form-control form-control-sm" placeholder="Search..." value="{{ request.GET.q }}" required>
            <button type="submit" class="btn btn-outline-dark btn-sm">
              <svg class="search" width="16" height="16">
                <use xlink:href="#search"></use>
              </svg>
            </button>
          </div>
        </form>
      </div>

      <!-- Mobile Search Icon -->
      <div class="d-lg-none">
        <button class="btn btn-link text-dark p-2" type="button" data-bs-toggle="collapse" data-bs-target="#mobileSearch">
          <svg width="20" height="20">
            <use xlink:href="#search"></use>
          </svg>
        </button>
      </div>

      <!-- Mobile Menu Toggle -->
      <button class="navbar-toggler border-0 p-1" type="button" data-bs-toggle="offcanvas" data-bs-target="#bdNavbar">
        <svg class="navbar-icon" width="24" height="24">
          <use xlink:href="#navbar-icon"></use>
        </svg>
      </button>

      <!-- Mobile Search Collapse -->
      <div class="collapse container-fluid d-lg-none" id="mobileSearch">
        <div class="py-2">
          <form action="{% url 'search' %}" method="get" class="d-flex">
            <input type="text" name="q" class="form-control form-control-sm me-2" placeholder="Search..." value="{{ request.GET.q }}" required>
            <button type="submit" class="btn btn-outline-dark btn-sm">Search</button>
          </form>
        </div>
      </div>

      <!-- Offcanvas Menu -->
      <div class="offcanvas offcanvas-end" tabindex="-1" id="bdNavbar">
        <div class="offcanvas-header px-3 py-2 border-bottom">
          <a class="navbar-brand" href="{% url 'home' %}">
            <img src="{% static 'images/eloutfit.png' %}" class="logo" style="width: 70px; height: 50px;">
          </a>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        
        <div class="offcanvas-body p-0">
          <ul class="navbar-nav">
            <li class="nav-item border-bottom">
              <a class="nav-link px-3 py-3" href="{% url 'home' %}">Home</a>
            </li>
            <li class="nav-item border-bottom">
              <a class="nav-link px-3 py-3" href="{% url 'product_list' %}">Products</a>
            </li>
            <li class="nav-item border-bottom">
              <a class="nav-link px-3 py-3" href="{% url 'cart:cart_detail' %}">Cart</a>
            </li>
            
            <!-- Categories Dropdown -->
            <li class="nav-item border-bottom">
              <a class="nav-link px-3 py-3 dropdown-toggle" data-bs-toggle="collapse" href="#categoriesCollapse">
                Categories
              </a>
              <div class="collapse" id="categoriesCollapse">
                <div class="p-2 bg-light">
                  {% for cat in categories %}
                  <a class="dropdown-item py-2" href="{% url 'product_list_by_category' cat.slug %}">
                    {{ cat.name }}
                  </a>
                  {% endfor %}
                  <hr class="my-1">
                  <a class="dropdown-item py-2" href="{% url 'product_list' %}">All Products</a>
                </div>
              </div>
            </li>

            <li class="nav-item border-bottom">
              <a class="nav-link px-3 py-3" href="{% url 'contact' %}">Contact</a>
            </li>

            <!-- User Authentication -->
            {% if user.is_authenticated %}
            <!-- Account Dropdown -->
            <li class="nav-item border-bottom">
              <a class="nav-link px-3 py-3 dropdown-toggle" data-bs-toggle="collapse" href="#accountCollapse">
                My Account
              </a>
              <div class="collapse" id="accountCollapse">
                <div class="p-2 bg-light">
                  <a href="{% url 'order_history' %}" class="dropdown-item py-2">My Orders</a>
                  <a href="{% url 'profile' %}" class="dropdown-item py-2">Profile</a>
                  <a href="{% url 'logout' %}" class="dropdown-item py-2 text-danger">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                  </a>
                </div>
              </div>
            </li>
            {% else %}
            <li class="nav-item border-bottom">
              <a class="nav-link px-3 py-3" href="{% url 'login' %}">Login</a>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>
  </nav>
</header>

<style>
.site-header {
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.navbar-brand { 
  margin-right: 0; 
}
/* Add padding to body to account for fixed header */
body { 
  padding-top: 70px; 
}
@media (max-width: 991.98px) {
  .navbar-nav .nav-link { 
    font-size: 1rem; 
  }
  .dropdown-item { 
    font-size: 0.9rem; 
  }
  body {
    padding-top: 60px;
  }
}
</style>